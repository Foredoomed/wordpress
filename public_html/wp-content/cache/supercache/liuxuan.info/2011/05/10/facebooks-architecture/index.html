<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">

<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>Facebook's architecture — Zhixingheyi</title>

<link rel="stylesheet" href="http://liuxuan.info/wp-content/themes/uncomplicated/style.css" type="text/css" media="screen" />
<link rel="pingback" href="http://liuxuan.info/xmlrpc.php" />




<link rel="alternate" type="application/rss+xml" title="Zhixingheyi &raquo; Facebook&#8217;s architecture Comments Feed" href="http://liuxuan.info/2011/05/10/facebooks-architecture/feed/" />
<link rel='stylesheet' id='wp-pagenavi-css'  href='http://liuxuan.info/wp-content/plugins/wp-pagenavi/pagenavi-css.css?ver=2.70' type='text/css' media='all' />
<script type='text/javascript' src='http://liuxuan.info/wp-includes/js/l10n.js?ver=20101110'></script>
<script type='text/javascript' src='http://liuxuan.info/wp-includes/js/comment-reply.js?ver=20090102'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://liuxuan.info/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://liuxuan.info/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Zhixingheyi' href='http://liuxuan.info/' />
<link rel='start' title='为什么Java匿名内部类中的方法参数必须定义为final' href='http://liuxuan.info/2011/03/07/java-anonymous-class/' />
<link rel='prev' title='《Pragmatic Programmers &#8211; Practices of an Agile Developer》读书笔记' href='http://liuxuan.info/2011/05/08/pragmatic-programmers-practices-of-an-agile-developer-notes/' />
<link rel='next' title='世界上最健康的作息时间表' href='http://liuxuan.info/2011/05/14/the-best-timetable-for-health-in-the-world/' />
<meta name="generator" content="WordPress 3.1.3" />
<link rel='shortlink' href='http://liuxuan.info/?p=90' />

<!-- All in One SEO Pack 1.6.13.2 by Michael Torbert of Semper Fi Web Design[307,364] -->
<meta name="description" content="Facebook's architecture" />
<meta name="keywords" content="facebook,architecture" />
<link rel="canonical" href="http://liuxuan.info/2011/05/10/facebooks-architecture/" />
<!-- /all in one seo pack -->

<!-- Bad Behavior 2.0.43 run time: 33.275 ms -->
<script type="text/javascript">
<!--
function bb2_addLoadEvent(func) {
	var oldonload = window.onload;
	if (typeof window.onload != 'function') {
		window.onload = func;
	} else {
		window.onload = function() {
			oldonload();
			func();
		}
	}
}

bb2_addLoadEvent(function() {
	for ( i=0; i < document.forms.length; i++ ) {
		if (document.forms[i].method == 'post') {
			var myElement = document.createElement('input');
			myElement.setAttribute('type', 'hidden');
			myElement.name = 'bb2_screener_';
			myElement.value = '1307074710 173.234.250.217';
			document.forms[i].appendChild(myElement);
		}
	}
});
// --></script>
		
<link rel="stylesheet" href="http://liuxuan.info/wp-content/plugins/wp-syntax/wp-syntax.css" type="text/css" media="screen" />
</head>

<body>

<div id="container">


<div id="header">
	<h1><a href="http://liuxuan.info/">Zhixingheyi</a></h1>
		<div class="border"></div>
	<h2>Where the truth distortion is.</h2>
</div>
	

<div id="menuholder">
		<div class="menu">
			<div class="page-navi"><ul><li ><a href="http://liuxuan.info/" title="Home">Home</a></li><li class="page_item page-item-41"><a href="http://liuxuan.info/about/" title="About">About</a></li><li class="page_item page-item-110"><a href="http://liuxuan.info/programmer-competency-matrix/" title="Programmer Competency Matrix">Programmer Competency Matrix</a></li></ul></div>
		</div>

		
</div>
	<div id="content">

	
		<div class="post-90 post type-post status-publish format-standard hentry category-architecture tag-architecture tag-facebook" id="post-90">
			<h2><a href="http://liuxuan.info/2011/05/10/facebooks-architecture/" rel="bookmark" title="Permanent Link: Facebook&#8217;s architecture">Facebook&#8217;s architecture</a></h2>
			<div class="postmetadata"><p>Posted on May 10th, 2011 under <a href="http://liuxuan.info/category/architecture/" title="View all posts in Architecture" rel="category tag">Architecture</a></p></div>
	
			<div class="entry">
				<p>原文地址：http://www.quora.com/What-is-Facebooks-architecture</p>
<ul>
<li>Web front-end written in PHP. Facebook&#8217;s HipHop [1] then converts it to C++ and compiles it using g++, thus providing a high performance templating and Web logic execution layer</li>
<li>Business logic is exposed as services using Thrift [2]. Some of these services are implemented in PHP, C++ or Java depending on service requirements (some other languages are probably used&#8230;)</li>
<li>Services implemented in Java don&#8217;t use any usual enterprise application server but rather use Facebook&#8217;s custom application server. At first this can look as wheel reinvented but as these services are exposed and consumed only (or mostly) using Thrift, the overhead of Tomcat, or even Jetty was probably too high with no significant added value for their need.</li>
<li>Persistence is done using MySQL, Memcached [3], Facebook&#8217;s Cassandra [4], Hadoop&#8217;s HBase [5]. Memcached is used as a cache for MySQL as well as a general purpose cache. Facebook engineers admit that their use of Cassandra is currently decreasing as they now prefer HBase for its simpler consistency model and its MapReduce ability.</li>
<li>Offline processing is done using Hadoop and Hive</li>
<li>Data such as logging, clicks and feeds transit using Scribe [6] and are aggregating and stored in HDFS using Scribe-HDFS [7], thus allowing extended analysis using MapReduce</li>
<li>BigPipe [8] is their custom technology to accelerate page rendering using a pipelining logic</li>
<li>Varnish Cache [9] is used for HTTP proxying. They&#8217;ve prefered it for its high performance and efficiency [10].</li>
<li>The storage of the billions of photos posted by the users is handled by Haystack, an ad-hoc storage solution developed by Facebook which brings low level optimizations and append-only writes [11].</li>
<li>Facebook Messages is using its own architecture which is notably based on infrastructure sharding and dynamic cluster management. Business logic and persistence is encapsulated in so-called &#8216;Cell&#8217;. Each Cell handles a part of users ; new Cells can be added as popularity grows [12]. Persistence is achieved using HBase [13].</li>
<li>Facebook Messages&#8217; search engine is built with an inverted index stored in HBase [14]</li>
<li>Facebook Search Engine&#8217;s implementation details are unknown as far as I know</li>
<li>The typeahead search uses a custom storage and retrieval logic [15]</li>
<li>Chat is based on an Epoll server developed in Erlang and accessed using Thrift [16]</li>
</ul>
<p>About the resources provisioned for each of these components, some information and numbers are known:</p>
<ul>
<li>Facebook is estimated to own more than 60,000 servers [17]. Their recent datacenter in Prineville, Oregon is based on entirely self-designed hardware [18] that was recently unveiled as Open Compute Project [19].</li>
<li>300 TB of data is stored in Memcached processes [20]</li>
<li>Their Hadoop and Hive cluster is made of 3000 servers with 8 cores, 32 GB RAM, 12 TB disks that is a total of 24k cores, 96 TB RAM and 36 PB disks [20]</li>
<li>100 billion hits per day, 50 billion photos, 3 trillion objects cached, 130 TB of logs per day as of july 2010 [21]</li>
</ul>
<p>
[1] <i>HipHop for PHP</i>: <a href="http://developers.facebook.com/blog/post/358" rel="nofollow" target="_blank" class="external_link">http://developers.faceboo<wbr>k.com/b&#8230;</wbr></a><br />[2] <i>Thrift</i>: <a href="http://thrift.apache.org/" rel="nofollow" target="_blank" class="external_link">http://thrift.apache.org/</a><br />[3] <i>Memcached</i>: <a href="http://memcached.org/" rel="nofollow" target="_blank" class="external_link">http://memcached.org/</a><br />[4] <i>Cassandra</i>: <a href="http://cassandra.apache.org/" rel="nofollow" target="_blank" class="external_link">http://cassandra.apache.o<wbr>rg/</wbr></a><br />[5] <i>HBase</i>: <a href="http://hbase.apache.org/" rel="nofollow" target="_blank" class="external_link">http://hbase.apache.org/</a><br />[6] <i>Scribe</i>: <a href="https://github.com/facebook/scribe" rel="nofollow" target="_blank" class="external_link">https://github.com/facebo<wbr>ok/scribe</wbr></a><br />[7] <i>Scribe-HDFS</i>: <a href="http://hadoopblog.blogspot.com/2009/06/hdfs-scribe-integration.html" rel="nofollow" target="_blank" class="external_link">http://hadoopblog.blogspo<wbr>t.com/2&#8230;</wbr></a><br />[8] <i>BigPipe</i>: <a href="http://www.facebook.com/notes/facebook-engineering/bigpipe-pipelining-web-pages-for-high-performance/389414033919" rel="nofollow" target="_blank" class="external_link">http://www.facebook.com/n<wbr>otes/fa&#8230;</wbr></a><br />[9] <i>Varnish Cache</i>: <a href="http://www.varnish-cache.org/" rel="nofollow" target="_blank" class="external_link">http://www.varnish-cache.<wbr>org/</wbr></a><br />[10] <i>Facebook goes for Varnish</i>: <a href="http://www.varnish-software.com/customers/facebook" rel="nofollow" target="_blank" class="external_link">http://www.varnish-softwa<wbr>re.com/&#8230;</wbr></a><br />[11] <i>Needle in a haystack</i>: efficient storage of billions of photos: <a href="http://www.facebook.com/note.php?note_id=76191543919" rel="nofollow" target="_blank" class="external_link">http://www.facebook.com/n<wbr>ote.php&#8230;</wbr></a><br />[12] <i>Scaling the Messages Application Back End</i>: <a href="http://www.facebook.com/note.php?note_id=10150148835363920" rel="nofollow" target="_blank" class="external_link">http://www.facebook.com/n<wbr>ote.php&#8230;</wbr></a><br />[13] <i>The Underlying Technology of Messages</i>: <a href="https://www.facebook.com/note.php?note_id=454991608919" rel="nofollow" target="_blank" class="external_link">https://www.facebook.com/<wbr>note.ph&#8230;</wbr></a><br />[14] <i>The Underlying Technology of Messages Tech Talk</i>: <a href="http://www.facebook.com/video/video.php?v=690851516105" rel="nofollow" target="_blank" class="external_link">http://www.facebook.com/v<wbr>ideo/vi&#8230;</wbr></a><br />[15] <i>Facebook&#8217;s typeahead search architecture</i>: <a href="http://www.facebook.com/video/video.php?v=432864835468" rel="nofollow" target="_blank" class="external_link">http://www.facebook.com/v<wbr>ideo/vi&#8230;</wbr></a><br />[16] <i>Facebook Chat</i>: <a href="http://www.facebook.com/note.php?note_id=14218138919" rel="nofollow" target="_blank" class="external_link">http://www.facebook.com/n<wbr>ote.php&#8230;</wbr></a><br />[17] <i>Who has the most Web Servers?</i>: <a href="http://www.datacenterknowledge.com/archives/2009/05/14/whos-got-the-most-web-servers/" rel="nofollow" target="_blank" class="external_link">http://www.datacenterknow<wbr>ledge.c&#8230;</wbr></a><br />[18] B<i>uilding Efficient Data Centers with the Open Compute Project</i>:&nbsp;<a href="http://www.facebook.com/note.php?note_id=10150144039563920" rel="nofollow" target="_blank" class="external_link">http://www.faceb<wbr>ook.com/note.php&#8230;</wbr></a><br />[19] <i>Open Compute Project</i>:&nbsp;<a href="http://opencompute.org/" rel="nofollow" target="_blank" class="external_link">http://opencompu<wbr>te.org/</wbr></a><br />[20] <i>Facebook&#8217;s architecture presentation at Devoxx 2010</i>: <a href="http://www.devoxx.com" rel="nofollow" target="_blank" class="external_link">http://www.devoxx.com</a><br />[21] <i>Scaling Facebook to 500 millions users and beyond</i>: <a href="http://www.facebook.com/note.php?note_id=409881258919" rel="nofollow" target="_blank" class="external_link">http://www.facebook.com/n<wbr>ote.php&#8230;</wbr></a></p>
			</div>
		
		</div>

	
<!-- You can start editing here. -->
<div id="commentssection">


			<!-- If comments are open, but there are no comments. -->

	 


<div id="respond">

<h3>Leave a Reply</h3>

<div class="cancel-comment-reply">
	<small><a rel="nofollow" id="cancel-comment-reply-link" href="/2011/05/10/facebooks-architecture/#respond" style="display:none;">Click here to cancel reply.</a></small>
</div>


<form action="http://liuxuan.info/wp-comments-post.php" method="post" id="commentform">


<p><input type="text" name="author" id="author" value="" size="22" tabindex="1" aria-required='true' />
<label for="author"><small>Name (required)</small></label></p>

<p><input type="text" name="email" id="email" value="" size="22" tabindex="2" aria-required='true' />
<label for="email"><small>Mail (will not be published) (required)</small></label></p>

<p><input type="text" name="url" id="url" value="" size="22" tabindex="3" />
<label for="url"><small>Website</small></label></p>


<!--<p><small><strong>XHTML:</strong> You can use these tags: <code>&lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;strike&gt; &lt;strong&gt; &lt;pre lang=&quot;&quot; line=&quot;&quot; escaped=&quot;&quot;&gt; </code></small></p>-->

<p><textarea name="comment" id="commentbox" cols="100%" rows="10" tabindex="4"></textarea></p>

<p><input name="submit" type="submit" id="submit" tabindex="5" value="Submit" />
<input type='hidden' name='comment_post_ID' value='90' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p>
<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="ddbf7c2150" /></p>
</form>

</div>


</div>
	
	</div>

<div id="sidebar">
<ul>
<h2>Search</h2><form method="get" id="searchform" action="http://liuxuan.info/">

<table cellpadding="0" cellspacing="0" style="width:200px; height:32px;"><tbody><tr id="WLSearchBoxPlaceholder"><td style="width:100%; border:solid 1px #cccccc; border-right-style:none;  padding-right:10px; vertical-align:middle;"><input id="WLSearchBoxInput" type="text"  style="background-image:url(http://www.bing.com/siteowner/s/siteowner/searchbox_background_k.png); background-position:right; background-repeat:no-repeat; font-family:Arial; font-size:14px; color:#000000; width:100%; border:none 0 transparent;" autocomplete="off" maxlength="200"></td><td style="border:solid 1px #cccccc; border-left-style:none; padding-left:0px; padding-right:3px;"><input id="WLSearchBoxButton" type="image" src="http://www.bing.com/siteowner/s/siteowner/searchbutton_normal_k.gif" style="border:none 0 transparent; height:24px; width:24px; vertical-align:top;"></td></tr></tbody></table>
</form>				<h2>Recent Posts</h2>		<ul>
				<li><a href="http://liuxuan.info/2011/06/01/comparison-of-nosql-databases/" title="Comparison of NoSQL databases">Comparison of NoSQL databases</a></li>
				<li><a href="http://liuxuan.info/2011/06/01/guide-to-open-source-licenses/" title="Guide to open source licenses">Guide to open source licenses</a></li>
				<li><a href="http://liuxuan.info/2011/05/19/block-advertising-on-youku-and-tudou/" title="屏蔽优酷和土豆网的广告方法">屏蔽优酷和土豆网的广告方法</a></li>
				<li><a href="http://liuxuan.info/2011/05/14/the-best-timetable-for-health-in-the-world/" title="世界上最健康的作息时间表">世界上最健康的作息时间表</a></li>
				<li><a href="http://liuxuan.info/2011/05/10/facebooks-architecture/" title="Facebook&#8217;s architecture">Facebook&#8217;s architecture</a></li>
				<li><a href="http://liuxuan.info/2011/05/08/pragmatic-programmers-practices-of-an-agile-developer-notes/" title="《Pragmatic Programmers &#8211; Practices of an Agile Developer》读书笔记">《Pragmatic Programmers &#8211; Practices of an Agile Developer》读书笔记</a></li>
				<li><a href="http://liuxuan.info/2011/05/08/initialization-on-demand-holder-idiom/" title="Initialization on demand holder idiom">Initialization on demand holder idiom</a></li>
				<li><a href="http://liuxuan.info/2011/05/04/http-definitive-guide-notes/" title="《Http Definitive Guide》读书笔记">《Http Definitive Guide》读书笔记</a></li>
				<li><a href="http://liuxuan.info/2011/04/13/learn-invokeinterface-invokespecial-invokestatic-invokevirtual/" title="Java bytecode : invokeinterface , invokespecial , invokestatic &amp; invokevirtual 的含义和区别">Java bytecode : invokeinterface , invokespecial , invokestatic &#038; invokevirtual 的含义和区别</a></li>
				<li><a href="http://liuxuan.info/2011/03/08/java-memory-management/" title="JVM内存管理">JVM内存管理</a></li>
				</ul>
		<h2>Categories</h2>		<ul>
	<li class="cat-item cat-item-31"><a href="http://liuxuan.info/category/architecture/" title="View all posts filed under Architecture">Architecture</a> (1)
</li>
	<li class="cat-item cat-item-38"><a href="http://liuxuan.info/category/cool/" title="View all posts filed under Cool">Cool</a> (1)
</li>
	<li class="cat-item cat-item-39"><a href="http://liuxuan.info/category/database/" title="View all posts filed under Database">Database</a> (1)
</li>
	<li class="cat-item cat-item-23"><a href="http://liuxuan.info/category/http/" title="View all posts filed under Http">Http</a> (1)
</li>
	<li class="cat-item cat-item-14"><a href="http://liuxuan.info/category/ide/" title="View all posts filed under IDE">IDE</a> (1)
</li>
	<li class="cat-item cat-item-3"><a href="http://liuxuan.info/category/java/" title="View all posts filed under Java">Java</a> (7)
</li>
	<li class="cat-item cat-item-5"><a href="http://liuxuan.info/category/life/" title="View all posts filed under Life">Life</a> (2)
</li>
	<li class="cat-item cat-item-4"><a href="http://liuxuan.info/category/objective-c/" title="View all posts filed under Objective-C">Objective-C</a> (1)
</li>
	<li class="cat-item cat-item-40"><a href="http://liuxuan.info/category/opensource/" title="View all posts filed under Opensource">Opensource</a> (1)
</li>
	<li class="cat-item cat-item-28"><a href="http://liuxuan.info/category/programming/" title="View all posts filed under Programming">Programming</a> (1)
</li>
		</ul>
<h2>Archives</h2>		<ul>
			<li><a href='http://liuxuan.info/2011/06/' title='June 2011'>June 2011</a>&nbsp;(2)</li>
	<li><a href='http://liuxuan.info/2011/05/' title='May 2011'>May 2011</a>&nbsp;(6)</li>
	<li><a href='http://liuxuan.info/2011/04/' title='April 2011'>April 2011</a>&nbsp;(1)</li>
	<li><a href='http://liuxuan.info/2011/03/' title='March 2011'>March 2011</a>&nbsp;(8)</li>
		</ul>

</ul>

</div>

<div id="footer">

<!-- To help keep our themes 100% free, please consider leaving our credit links intact. Thanks! -->

<p>&copy; 2011 Zhixingheyi | Powered by <a href="http://wordpress.org/">WordPress</a> | Theme by <a href="http://liuxuan.info/" title="WordPress theme by Foredoomed">Foredoomed</a></p>

</div> <!-- end footer -->

</div> <!-- end container -->

<div align="center">
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img alt="知识共享许可协议" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">知识共享署名-非商业性使用-相同方式共享 3.0 Unported许可协议</a>进行许可。
<div>
</body>
</html>
<!-- Dynamic page generated in 0.782 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-06-03 04:18:31 -->
<!-- super cache -->